<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest√µes - Rota de Ataque Quest√µes</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.ico">
    <link rel="mask-icon" href="favicon.svg" color="#c1121f">
    <script src="utils.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #1b1b1b;
            color: #f2f2f2;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background-color: rgba(27, 27, 27, 0.95);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(242, 242, 242, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #c1121f;
        }

        .nav {
            display: flex;
            gap: 2rem;
        }

        .nav a {
            color: #f2f2f2;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav a:hover {
            color: #c1121f;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 2rem 0;
        }

        /* Filters */
        .filters {
            background-color: #2a2a2a;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .filters h2 {
            margin-bottom: 1.5rem;
            color: #f2f2f2;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #f2f2f2;
        }

        .filter-group select, .filter-group input {
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #333;
            color: #f2f2f2;
            font-size: 1rem;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #c1121f;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: #c1121f;
            color: #f2f2f2;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn:hover {
            background-color: #a0101a;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: transparent;
            border: 2px solid #c1121f;
            color: #c1121f;
        }

        .btn-secondary:hover {
            background-color: #c1121f;
            color: #f2f2f2;
        }

        /* Question Container */
        .questao-container {
            background-color: #2a2a2a;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .questao-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #444;
        }

        .questao-info {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .questao-tag {
            background-color: #c1121f;
            color: #f2f2f2;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .questao-enunciado {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            color: #f2f2f2;
        }

        /* Alternatives */
        .alternativas {
            margin-bottom: 2rem;
        }

        .alternativa {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid #444;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #333;
        }

        .alternativa:hover {
            border-color: #c1121f;
            background-color: #3a3a3a;
        }

        .alternativa.selecionada {
            border-color: #c1121f;
            background-color: #3a3a3a;
        }

        .alternativa.correta {
            border-color: #28a745;
            background-color: rgba(40, 167, 69, 0.2);
        }

        .alternativa.incorreta {
            border-color: #dc3545;
            background-color: rgba(220, 53, 69, 0.2);
        }

        .alternativa-letra {
            background-color: #c1121f;
            color: #f2f2f2;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .alternativa-texto {
            flex: 1;
        }

        /* Feedback */
        .feedback {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            display: none;
        }

        .feedback.acerto {
            background-color: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
        }

        .feedback.erro {
            background-color: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
        }

        .feedback h3 {
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .xp-gain {
            background-color: #28a745;
            color: #f2f2f2;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 1rem;
            font-weight: 600;
        }

        /* Comments */
        .comentarios {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #444;
        }

        .comentario-professor {
            background-color: #333;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .comentario-professor h4 {
            color: #c1121f;
            margin-bottom: 1rem;
        }

        .comentarios-alunos {
            margin-top: 1.5rem;
        }

        .comentario-aluno {
            background-color: #333;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .comentario-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #ccc;
        }

        .novo-comentario {
            margin-top: 1.5rem;
        }

        .novo-comentario textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #333;
            color: #f2f2f2;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        .novo-comentario textarea:focus {
            outline: none;
            border-color: #c1121f;
        }

        /* Pagination */
        .paginacao {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }

        .paginacao button {
            padding: 0.5rem 1rem;
            border: 1px solid #444;
            background-color: #333;
            color: #f2f2f2;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .paginacao button:hover {
            background-color: #c1121f;
            border-color: #c1121f;
        }

        .paginacao button.active {
            background-color: #c1121f;
            border-color: #c1121f;
        }

        .paginacao button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        /* Freemium Warning */
        .freemium-warning {
            background-color: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: center;
            display: none;
        }

        .freemium-warning h3 {
            color: #dc3545;
            margin-bottom: 1rem;
        }

        /* Footer */
        .footer {
            background-color: #111111;
            padding: 2rem 0;
            text-align: center;
            border-top: 1px solid #333;
            margin-top: 4rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }

            .questao-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .questao-info {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">Rota de Ataque Quest√µes</div>
                                        <nav class="nav">
                            <a href="/">In√≠cio</a>
                            <a href="/questoes">Quest√µes</a>
                            <a href="/ranking">Ranking</a>
                            <a href="/planos">Planos</a>
                            <a href="/perfil">Perfil</a>
                        </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Freemium Warning -->
            <div class="freemium-warning" id="freemiumWarning">
                <h3>‚ö†Ô∏è Limite de Quest√µes Atingido</h3>
                <p>Voc√™ j√° respondeu 10 quest√µes no plano gratuito. Fa√ßa upgrade para Premium e tenha acesso ilimitado!</p>
                                         <a href="/planos" class="btn">Fazer Upgrade</a>
            </div>

            <!-- Filters -->
            <section class="filters">
                <h2>Filtrar Quest√µes</h2>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="disciplina">Disciplina</label>
                        <select id="disciplina" onchange="filtrarAssuntos()">
                            <option value="">Todas as disciplinas</option>
                            <option value="Direito Constitucional">Direito Constitucional</option>
                            <option value="Direito Administrativo">Direito Administrativo</option>
                            <option value="Portugu√™s">Portugu√™s</option>
                            <option value="Matem√°tica">Matem√°tica</option>
                            <option value="Geografia">Geografia</option>
                            <option value="Hist√≥ria">Hist√≥ria</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="assunto">Assunto</label>
                        <select id="assunto">
                            <option value="">Todos os assuntos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="banca">Banca</label>
                        <select id="banca">
                            <option value="">Todas as bancas</option>
                            <option value="CESPE">CESPE</option>
                            <option value="FGV">FGV</option>
                            <option value="VUNESP">VUNESP</option>
                            <option value="FCC">FCC</option>
                            <option value="IBFC">IBFC</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="orgao">√ìrg√£o</label>
                        <select id="orgao">
                            <option value="">Todos os √≥rg√£os</option>
                            <option value="Pol√≠cia Federal">Pol√≠cia Federal</option>
                            <option value="Receita Federal">Receita Federal</option>
                            <option value="Tribunal de Justi√ßa">Tribunal de Justi√ßa</option>
                            <option value="Minist√©rio P√∫blico">Minist√©rio P√∫blico</option>
                            <option value="Banco Central">Banco Central</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="ano">Ano</label>
                        <select id="ano">
                            <option value="">Todos os anos</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn" onclick="filtrarQuestoes()">Filtrar</button>
                    </div>
                </div>
            </section>

            <!-- Question -->
            <section class="questao-container">
                <div class="questao-header">
                    <div class="questao-info">
                        <span class="questao-tag" id="questaoId">Quest√£o #1</span>
                        <span class="questao-tag" id="questaoDisciplina">Direito Constitucional</span>
                        <span class="questao-tag" id="questaoBanca">CESPE</span>
                        <span class="questao-tag" id="questaoAno">2023</span>
                    </div>
                    <div>
                        <span style="color: #c1121f; font-weight: 600;">XP: <span id="userXP">150</span></span>
                        <span style="margin-left: 1rem; color: #f2f2f2; font-weight: 600;" id="userPatente">üåü Iniciante</span>
                    </div>
                </div>

                <div class="questao-enunciado" id="questaoEnunciado">
                    Carregando quest√£o...
                </div>

                <div class="alternativas" id="alternativas">
                    <!-- Alternativas ser√£o carregadas dinamicamente -->
                </div>

                <button class="btn btn-responder" id="btnResponder" onclick="responderQuestao()" disabled>Selecione uma alternativa</button>

                <div class="feedback" id="feedback">
                    <!-- Feedback ser√° mostrado aqui -->
                </div>

                <div class="comentarios" id="comentarios" style="display: none;">
                    <div class="comentario-professor">
                        <h4>üí° Coment√°rio do Professor</h4>
                        <div id="comentarioProfessor"></div>
                    </div>

                    <div class="comentarios-alunos">
                        <h4>üí¨ Coment√°rios dos Alunos</h4>
                        <div id="listaComentarios"></div>
                        
                        <div class="novo-comentario">
                            <h5>Adicionar Coment√°rio</h5>
                            <textarea id="novoComentario" placeholder="Digite seu coment√°rio..."></textarea>
                            <button class="btn" onclick="adicionarComentario()" style="margin-top: 1rem;">Enviar Coment√°rio</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Pagination -->
            <div class="paginacao">
                <button onclick="mudarQuestao(-1)" id="btnAnterior" disabled>‚Üê Anterior</button>
                <button class="active" id="paginaAtual">1</button>
                <button onclick="mudarQuestao(1)" id="btnProxima">Pr√≥xima ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Rota de Ataque Quest√µes. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        // Estado da aplica√ß√£o
        let questoes = [];
        let questaoAtual = 0;
        let alternativaSelecionada = null;
        let questaoRespondida = false;
        let questoesRespondidas = 0;
        let userXP = 150;
        let userStatus = 'gratuito'; // ou 'premium'
        let categorias = { disciplinas: [], bancas: [], orgaos: [] };
        let assuntos = [];
        let carregando = false;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            carregarCategorias();
            carregarQuestoes();
            atualizarXP();
        });

        // Fun√ß√£o para carregar categorias (disciplinas, bancas, √≥rg√£os)
        async function carregarCategorias() {
            try {
                const response = await fetch('http://localhost:3002/api/categories/todas');
                if (!response.ok) throw new Error('Erro ao carregar categorias');
                
                const data = await response.json();
                categorias = data;
                
                // Preencher select de disciplinas
                const disciplinaSelect = document.getElementById('disciplina');
                disciplinaSelect.innerHTML = '<option value="">Todas as disciplinas</option>';
                categorias.disciplinas.forEach(disciplina => {
                    const option = document.createElement('option');
                    option.value = disciplina.id;
                    option.textContent = disciplina.nome;
                    disciplinaSelect.appendChild(option);
                });
                
                // Preencher select de bancas
                const bancaSelect = document.getElementById('banca');
                bancaSelect.innerHTML = '<option value="">Todas as bancas</option>';
                categorias.bancas.forEach(banca => {
                    const option = document.createElement('option');
                    option.value = banca.id;
                    option.textContent = banca.nome;
                    bancaSelect.appendChild(option);
                });
                
                // Preencher select de √≥rg√£os
                const orgaoSelect = document.getElementById('orgao');
                orgaoSelect.innerHTML = '<option value="">Todos os √≥rg√£os</option>';
                categorias.orgaos.forEach(orgao => {
                    const option = document.createElement('option');
                    option.value = orgao.id;
                    option.textContent = orgao.nome;
                    orgaoSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
                mostrarMensagem('Erro ao carregar categorias. Tente novamente.', 'error');
            }
        }

        // Fun√ß√£o para carregar assuntos por disciplina
        async function carregarAssuntosPorDisciplina(disciplinaId) {
            try {
                if (!disciplinaId) {
                    assuntos = [];
                    const assuntoSelect = document.getElementById('assunto');
                    assuntoSelect.innerHTML = '<option value="">Todos os assuntos</option>';
                    return;
                }
                
                const response = await fetch(`http://localhost:3002/api/categories/assuntos/${disciplinaId}`);
                if (!response.ok) throw new Error('Erro ao carregar assuntos');
                
                const data = await response.json();
                assuntos = data.assuntos;
                
                // Preencher select de assuntos
                const assuntoSelect = document.getElementById('assunto');
                assuntoSelect.innerHTML = '<option value="">Todos os assuntos</option>';
                assuntos.forEach(assunto => {
                    const option = document.createElement('option');
                    option.value = assunto.id;
                    option.textContent = assunto.nome;
                    assuntoSelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar assuntos:', error);
                mostrarMensagem('Erro ao carregar assuntos. Tente novamente.', 'error');
            }
        }

        // Fun√ß√£o para carregar quest√µes da API
        async function carregarQuestoes() {
            if (carregando) return;
            
            carregando = true;
            mostrarCarregando(true);
            
            try {
                // Coletar filtros
                const disciplinaId = document.getElementById('disciplina').value;
                const assuntoId = document.getElementById('assunto').value;
                const bancaId = document.getElementById('banca').value;
                const orgaoId = document.getElementById('orgao').value;
                const ano = document.getElementById('ano').value;
                
                // Construir URL com query parameters
                const params = new URLSearchParams();
                if (disciplinaId) params.append('disciplina_id', disciplinaId);
                if (assuntoId) params.append('assunto_id', assuntoId);
                if (bancaId) params.append('banca_id', bancaId);
                if (orgaoId) params.append('orgao_id', orgaoId);
                if (ano) params.append('ano', ano);
                params.append('limit', '50'); // Buscar mais quest√µes
                
                const response = await fetch(`http://localhost:3002/api/questions?${params.toString()}`);
                if (!response.ok) throw new Error('Erro ao carregar quest√µes');
                
                const data = await response.json();
                questoes = data.questoes;
                
                // Resetar estado
                questaoAtual = 0;
                alternativaSelecionada = null;
                questaoRespondida = false;
                
                if (questoes.length > 0) {
                    carregarQuestao();
                } else {
                    mostrarMensagem('Nenhuma quest√£o encontrada com os filtros aplicados.', 'info');
                    document.getElementById('questaoEnunciado').textContent = 'Nenhuma quest√£o encontrada.';
                    document.getElementById('alternativas').innerHTML = '';
                    document.getElementById('btnResponder').disabled = true;
                }
                
            } catch (error) {
                console.error('Erro ao carregar quest√µes:', error);
                mostrarMensagem('Erro ao carregar quest√µes. Tente novamente.', 'error');
                document.getElementById('questaoEnunciado').textContent = 'Erro ao carregar quest√µes.';
            } finally {
                carregando = false;
                mostrarCarregando(false);
            }
        }

        // Fun√ß√£o para carregar uma quest√£o
        function carregarQuestao() {
            if (questoes.length === 0) return;
            
            const questao = questoes[questaoAtual];
            
            document.getElementById('questaoId').textContent = `Quest√£o #${questao.id}`;
            document.getElementById('questaoDisciplina').textContent = questao.disciplina.nome;
            document.getElementById('questaoBanca').textContent = questao.banca.nome;
            document.getElementById('questaoAno').textContent = questao.ano;
            document.getElementById('questaoEnunciado').textContent = questao.enunciado;
            
            // Carregar alternativas
            const alternativasDiv = document.getElementById('alternativas');
            alternativasDiv.innerHTML = '';
            
            const alternativas = {
                A: questao.alternativa_a,
                B: questao.alternativa_b,
                C: questao.alternativa_c,
                D: questao.alternativa_d,
                E: questao.alternativa_e
            };
            
            Object.entries(alternativas).forEach(([letra, texto]) => {
                if (texto) { // S√≥ mostrar alternativas que existem
                    const alternativa = document.createElement('div');
                    alternativa.className = 'alternativa';
                    alternativa.onclick = () => selecionarAlternativa(letra);
                    alternativa.innerHTML = `
                        <div class="alternativa-letra">${letra}</div>
                        <div class="alternativa-texto">${texto}</div>
                    `;
                    alternativasDiv.appendChild(alternativa);
                }
            });
            
            // Resetar estado
            alternativaSelecionada = null;
            questaoRespondida = false;
            document.getElementById('btnResponder').disabled = true;
            document.getElementById('btnResponder').textContent = 'Selecione uma alternativa';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('comentarios').style.display = 'none';
            
            // Atualizar pagina√ß√£o
            document.getElementById('paginaAtual').textContent = questaoAtual + 1;
            document.getElementById('btnAnterior').disabled = questaoAtual === 0;
            document.getElementById('btnProxima').disabled = questaoAtual === questoes.length - 1;
        }

        // Fun√ß√£o para selecionar alternativa
        function selecionarAlternativa(letra) {
            if (questaoRespondida) return;
            
            // Remover sele√ß√£o anterior
            document.querySelectorAll('.alternativa').forEach(alt => {
                alt.classList.remove('selecionada');
            });
            
            // Selecionar nova alternativa
            const alternativa = document.querySelector(`.alternativa:nth-child(${letra.charCodeAt(0) - 64})`);
            if (alternativa) {
                alternativa.classList.add('selecionada');
                alternativaSelecionada = letra;
                
                // Habilitar bot√£o de responder
                document.getElementById('btnResponder').disabled = false;
                document.getElementById('btnResponder').textContent = 'Responder Quest√£o';
            }
        }

        // Fun√ß√£o para responder quest√£o
        async function responderQuestao() {
            if (!alternativaSelecionada || questaoRespondida) return;
            
            const questao = questoes[questaoAtual];
            
            try {
                // Verificar se usu√°rio est√° logado
                const token = localStorage.getItem('token');
                if (!token) {
                    mostrarMensagem('Fa√ßa login para responder quest√µes.', 'warning');
                    return;
                }
                
                // Enviar resposta para a API
                const response = await fetch(`http://localhost:3002/api/questions/${questao.id}/responder`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        alternativa_marcada: alternativaSelecionada,
                        tempo_resposta: 0 // Por enquanto, n√£o estamos medindo tempo
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    if (errorData.upgradeRequired) {
                        document.getElementById('freemiumWarning').style.display = 'block';
                        mostrarMensagem('Limite de quest√µes gratuitas atingido. Fa√ßa upgrade para Premium!', 'warning');
                    } else {
                        throw new Error(errorData.message || 'Erro ao responder quest√£o');
                    }
                    return;
                }
                
                const data = await response.json();
                
                // Mostrar feedback
                const feedback = document.getElementById('feedback');
                feedback.style.display = 'block';
                feedback.className = `feedback ${data.acertou ? 'acerto' : 'erro'}`;
                
                if (data.acertou) {
                    feedback.innerHTML = `
                        <h3>üéâ Parab√©ns! Voc√™ acertou!</h3>
                        <p>A alternativa correta √©: <strong>${data.gabarito}</strong></p>
                        <div class="xp-gain">+${data.xpGanho} XP</div>
                        <p>XP Total: <strong>${data.novoXP}</strong></p>
                        <p>Quest√µes respondidas: <strong>${data.questoes_respondidas}</strong></p>
                    `;
                } else {
                    feedback.innerHTML = `
                        <h3>‚ùå Que pena! Voc√™ errou.</h3>
                        <p>Sua resposta: <strong>${data.alternativa_marcada}</strong></p>
                        <p>Resposta correta: <strong>${data.gabarito}</strong></p>
                        <p>Quest√µes respondidas: <strong>${data.questoes_respondidas}</strong></p>
                    `;
                }
                
                // Marcar alternativas
                document.querySelectorAll('.alternativa').forEach((alt, index) => {
                    const letra = String.fromCharCode(65 + index);
                    if (letra === data.gabarito) {
                        alt.classList.add('correta');
                    } else if (letra === data.alternativa_marcada && !data.acertou) {
                        alt.classList.add('incorreta');
                    }
                });
                
                // Atualizar estado
                questaoRespondida = true;
                questoesRespondidas = data.questoes_respondidas;
                userXP = data.novoXP;
                atualizarXP();
                
                // Mostrar coment√°rios
                setTimeout(() => {
                    document.getElementById('comentarios').style.display = 'block';
                    carregarComentariosQuestao(questao.id);
                }, 1000);
                
                // Desabilitar bot√£o
                document.getElementById('btnResponder').disabled = true;
                
            } catch (error) {
                console.error('Erro ao responder quest√£o:', error);
                mostrarMensagem('Erro ao responder quest√£o. Tente novamente.', 'error');
            }
        }

        // Fun√ß√£o para mudar quest√£o
        function mudarQuestao(direcao) {
            const novaQuestao = questaoAtual + direcao;
            if (novaQuestao >= 0 && novaQuestao < questoes.length) {
                questaoAtual = novaQuestao;
                carregarQuestao();
            }
        }

        // Fun√ß√£o para filtrar quest√µes
        function filtrarQuestoes() {
            carregarQuestoes();
        }

        // Fun√ß√£o para filtrar assuntos baseado na disciplina
        function filtrarAssuntos() {
            const disciplinaId = document.getElementById('disciplina').value;
            carregarAssuntosPorDisciplina(disciplinaId);
        }

        // Fun√ß√£o para mostrar/ocultar carregamento
        function mostrarCarregando(mostrar) {
            const btnFiltrar = document.querySelector('.btn');
            if (mostrar) {
                btnFiltrar.textContent = 'Carregando...';
                btnFiltrar.disabled = true;
            } else {
                btnFiltrar.textContent = 'Filtrar';
                btnFiltrar.disabled = false;
            }
        }

        // Fun√ß√£o para mostrar mensagens
        function mostrarMensagem(mensagem, tipo = 'info') {
            // Criar elemento de mensagem
            const mensagemDiv = document.createElement('div');
            mensagemDiv.className = `mensagem ${tipo}`;
            mensagemDiv.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 1rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            // Definir cor baseada no tipo
            switch (tipo) {
                case 'error':
                    mensagemDiv.style.backgroundColor = '#dc3545';
                    break;
                case 'success':
                    mensagemDiv.style.backgroundColor = '#28a745';
                    break;
                case 'warning':
                    mensagemDiv.style.backgroundColor = '#ffc107';
                    mensagemDiv.style.color = '#000';
                    break;
                default:
                    mensagemDiv.style.backgroundColor = '#17a2b8';
            }
            
            mensagemDiv.textContent = mensagem;
            document.body.appendChild(mensagemDiv);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                if (mensagemDiv.parentNode) {
                    mensagemDiv.parentNode.removeChild(mensagemDiv);
                }
            }, 5000);
        }

        // Fun√ß√£o para atualizar XP
        function atualizarXP() {
            document.getElementById('userXP').textContent = userXP;
        }

        // Fun√ß√£o para carregar coment√°rios de uma quest√£o
        async function carregarComentariosQuestao(questaoId) {
            try {
                const response = await fetch(`http://localhost:3002/api/questions/${questaoId}/comentarios`);
                if (!response.ok) throw new Error('Erro ao carregar coment√°rios');
                
                const data = await response.json();
                const comentarios = data.comentarios;
                
                const listaComentarios = document.getElementById('listaComentarios');
                listaComentarios.innerHTML = '';
                
                if (comentarios.length === 0) {
                    listaComentarios.innerHTML = '<p>Nenhum coment√°rio ainda. Seja o primeiro a comentar!</p>';
                    return;
                }
                
                comentarios.forEach(comentario => {
                    const div = document.createElement('div');
                    div.className = 'comentario-aluno';
                    div.innerHTML = `
                        <div class="comentario-header">
                            <span>${comentario.usuario.nome}</span>
                            <span>${new Date(comentario.data_criacao).toLocaleDateString('pt-BR')}</span>
                        </div>
                        <div>${comentario.texto}</div>
                    `;
                    listaComentarios.appendChild(div);
                });
                
            } catch (error) {
                console.error('Erro ao carregar coment√°rios:', error);
                const listaComentarios = document.getElementById('listaComentarios');
                listaComentarios.innerHTML = '<p>Erro ao carregar coment√°rios.</p>';
            }
        }

        // Fun√ß√£o para adicionar coment√°rio
        async function adicionarComentario() {
            const texto = document.getElementById('novoComentario').value.trim();
            if (!texto) return;
            
            const questao = questoes[questaoAtual];
            const token = localStorage.getItem('token');
            
            if (!token) {
                mostrarMensagem('Fa√ßa login para adicionar coment√°rios.', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:3002/api/questions/${questao.id}/comentarios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ texto })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Erro ao adicionar coment√°rio');
                }
                
                const data = await response.json();
                mostrarMensagem('Coment√°rio enviado com sucesso! Aguarde aprova√ß√£o.', 'success');
                
                // Limpar campo
                document.getElementById('novoComentario').value = '';
                
                // Recarregar coment√°rios
                carregarComentariosQuestao(questao.id);
                
            } catch (error) {
                console.error('Erro ao adicionar coment√°rio:', error);
                mostrarMensagem('Erro ao adicionar coment√°rio. Tente novamente.', 'error');
            }
        }
    </script>
</body>
</html>
